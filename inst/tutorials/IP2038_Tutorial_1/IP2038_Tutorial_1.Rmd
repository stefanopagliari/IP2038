---
title: "1. Getting Started with R and RStudio"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
```

      
 
## An Introduction to R

![](images/RStats_Logo.jpeg)
<br>

In this module, you will learn how to download, manipulate, and examine and visualize data in "R". R is a programming language designed for statistical computing that is widely used in academia and the data science community.

Unlike softwares like Excel or SPSS, R works by entering instructions (code) at a prompt. When you type an instruction and hit return, R interprets it and sends any resulting output back to the console. 
For instance, the interactive boxes below simulate how typing instructions in R works. You can click on "Run Code" below to see the result of your instructions

For instance, you can click on "Run Code" below to see what happens when you instruct R to calculate the square root of 9.

```{r NameChunk, exercise = TRUE}
sqrt(9)
```

...or a more advanced example, see what happens when you create a plot to compare the evolution of the gdp per capita of the United Kingdom and Japan in the postwar era.


```{r fertility, exercise = TRUE, message = FALSE}
library(gapminder)
library(tidyverse)

countries <- c("United Kingdom","Japan")

gapminder %>% filter(country %in% countries) %>% 
  ggplot(aes(x = year, 
             y = gdpPercap, 
             colour = country)) +
  geom_line()
```

The code-boxes in this tutorial allow you to see the output of running different instructions using R. You can edit the content of the code and click on "Run Code" to see the output. For instance, what happens if you replace "Japan" with France?

---

### Why  R?

- **R** is s free and open-source (unlike Stata, SPSS, and SASS)
- It is powerful and able to handle large datasets (more so than MS Excel)
- It has a shorter learning curve than other computing languages (like Python).
- It has a large and expanding user community building "packages" containing tools we can use to import and analyze data

---

### How will we learn Data Analysis with R

There is no assigned textbook for R for this module. Instead, the lectures, interactive online tutorials such as this one, and the weekly sessions in the computer lab will introduce you to all the main steps required to get started with doing data analysis in R and to complete the assignment for this module.
More specifically:
- The weekly lectures will provide you with an introduction to the different steps involved in the doing exploratory data analysis
- The online interactive tutorials will explain how these steps can be completed using R and provide interactive examples you can use
- The weekly computer labs will allow you to put in practice what we learnt with the help the tutorial leader



### Additional Resources
These two freely available e-books provide an excellent and accessible reference to respectively data analysis and data visualization using R.



:::: {style="display: grid; grid-template-columns: 40% 40%; grid-column-gap: 5%; "}

::: {}

+ Wickham, Hadley, and Garrett Grolemund (2017). "R for Data Science". O’Reilly. [link](https://r4ds.had.co.nz)

:::

::: {}
![](images/RFDS_cover.png){width=80%}

:::

::: {}

+ Healey, Kieran (2018), "Data Visualization. A Practical Introduction", Princeton University Press [link](https://socviz.co)

:::

::: {}



![](images/Healy_Data_Visualization_Cover.jpg){width=80%}

:::

::::


---


### Searching for Help

A key skill in learning to programme is to learn to search the internet. This is something that both novel programmers as well as experienced data analysts do routinely. It is important that you learn how to "look for help" on the internet. 

Two common approaches are:

+ Search what you are trying to achieve on a search engine, by specifying the language (R) or specific package (e.g. `tidyverse`, `ggplot`) you are using. For instance, you could search on Google "how to filter a dataframe in R" or "how to change the label colour in ggplot")
+ Often the first results that will be returned by a search engine are pages on Stackoverflow. This is a website where users post questions and receive advise. The most useful answer is usually voted up and found at the top. You can search this website for previously posted questions similar to yours or ask new questions. 

![](images/StackOverflow_Most_Asked_Questions.png){width=50%}
[source](https://i.imgur.com/AFH3v7h.png)

---


## RStudio and RStudio Cloud

The original interface is simple but difficult to use. Instead, in this module we will learn to use R from Rstudio.

**RStudio** is an integrated development environment (IDE) used to programme in R. In other words, RStudio is a software that helps you to write R code, examine data, produce graphs, present your findings.

![](images/RStudio_Image.png){width=80%}


---

### (Optional) Installing RStudio on your personal computer 


R and RStudio are free to download and use on your personal computer. In order to install RStudio on your computer you need to:

+ **Download and install R** (the programming language) from https://cran.r-project.org/. R is maintained by an international team of developers who make the language available through the web page of [The Comprehensive R Archive Network](http://cran.r-project.org/). The top of the web page provides three links for downloading R. Follow the link that describes your operating system: Windows, Mac, or Linux.
+ **Download and install RStudio Desktop** on your computer from https://rstudio.com/products/rstudio/download/. Once you’ve installed RStudio, you can open it like any other program on your computer—usually by clicking an icon on your desktop.

*Please note that this is not required for this module as we will use the browser-based version RStudio (RStudio Cloud)*

---


### RStudio Cloud
![](images/RStudio_Cloud_Logo.png){width=70%}

 
**RStudio Cloud** (<https://rstudio.cloud/>) is a lightweight, cloud-based version of RStudio that runs on a browser. City has paid for a module subscription, which will make it easier for you to access RStudio and complete the module.
You can switch over to a free individual RStudio Cloud plan once the module is completed.

---

### Getting Started in RStudio Cloud

- You should have received an email from RStudio Cloud that looks like this:

![](images/EmailRStudioCloud.png){width=70%}

- The email contains a link that will direct you towards the webpage where you can create your account. In order to do to:

+ You must use your City email address

![](images/RStudioCloudRegister.png){width=70%}

+ Choose a strong password
+ You must use your first and last names registered with City


After you have completed your registration, you can access RStudio Cloud from your browser by navigating to: https://rstudio.cloud/ using your browser. Here you will need to sign in using your city email and your new RStudio Cloud password. 

---

### RStudio Cloud Interface

![](images/RStudioCloudInterface.png){width=90%}

When you open RStudio Cloud, you will see different elements:

+ **Your Workspace**: here you can create your own projects as well as copy your own versions of the weekly worksheets
+ **Tutorials**: This folder contains code used in the tutorials of this module. You can run the code included in these projects but you cannot edit it. In order to edit it, you will need to create your own copy of the projects. Save this weekly project as a new file by clicking on "Save a Permanent Copy".

![](images/RStudioSavePermanent.png){width=90%}


### RStudio Working Environment 
When you open a project in RStudio Cloud, you will access the main working environment.

![](images/RStudio_Panels.png){width=90%}


This has has four main panels.

+ **Console**: where you can execute commands and see the results. Commands run here are temporary, and will be lost if you close R. 
+ **Code Editor**: where you work on different code files that can be saved.
+ **Environment/History**: this space shows the objects that you create and work with
+ **Files/Help/Packages**: in this space you can see your files, plots and graphs that you produce, R packages that you install, help with packages.
 

---


### Importing/Exporting files from RStudio Cloud

 
From the Files tab you can manage the files that are stored in your project folder. In particular, here you will find the commands to:

- **upload** a file from your computer to the project folder
- **delete** a file from  the project folder
- **rename** a file in your project folder
- download a file from the project folder to your computer (**more --> export **)

---


## Writing R Code

It is possible to execute commands by writing them in the Console on the bottom of the RStudio environment. However, if you close R, you lose this command history and thus the ability to replicate what you have done.

Just as we "save" files (like MS Word documents), so that we don't lose our work, in R you can save your R Scripts, so that you don't lose the various R commands that you have executed. A script is a series of commands that you can save, modify, and re-run whenever you like.

In RStudio, you will create, edit, and save scripts from the code editor panel

![](images/Code_Editor.png){width=90%}

---

### How to create a R Script

In order to create a new R Script:

- Go to the Code Editor panel and click on the "New File" button
- Select "R Script"
![](images/CreateRScript.png){width=90%}
 
 Once you have created a script, you can then type multiple instructions within different lines of your code, run, and save the script.

![](images/ExampleRScript.png){width=50%}
 

### How to Run a R Script

There are different ways to run a script. You can:

- Type the command in the Console 
- You can run your script line by clicking on a line and typing Command+Enter (Mac OS) or Control+Enter (Windows) to run the line, or hitting `Run` from the dropdown menu.
- To run the whole script, type Ctrl+Shift+Enter on Windows, Command+Shift+Enter.
- You can also process your script by clicking on the "Run" icon at the top of the script editor. If a line is selected, this will run only that line. Otherwise, the entire script will be compiled.

![](images/RStudio_Run_Script.png){width=90%}

---

### How to Save a R Script

In order to save a R script you can:

- type Control + S (panels) or Command + S (Mac OS)
- Click the "save" button
- By default the script will be saved in the folder of your project.



---

### Commenting your code

 R code can be hard to read. If someone else tries to read it (or you later on), it might be hard to figure out what you have done. Adding comments make code easier to read. 

In R you can insert a comment in your script by placing `#` at the beginning of your code. 
 
See this example:

```{r ExampleComment, exercise=TRUE}
#This script creates data and returns TRUE if the mean is less than the median.
#Autor: YOUR NAME
#Version: 1.0
#Date January 1, 2020

# Create the number vector (sequence of numbers) called x
x <- c(1, 3, 4)
# Compute the mean of vector x and store value it in object y
y <- mean(x)
# Compute the median of vector x and store value it in object z
z <- median(x)
# Compare the mean and median of vector x with a logical expression
y < z

```

It is also possible to place a comment (`#`) at the end of a line of code.

![](images/RCommentEndLine.png){width=80%}




---

## Objects in R

### Creating Objects with the Assignment Operator `<-`
R is an object-oriented language, that is, data and code can be saved as **objects**.

Instead of sending the result of our command to the console, we can use the `<-` operator to assign the results to an object we create. This is a combination of the lesser than sign and the dash.

To see the results of what you stored in the object, you can simply type the name of the object in the console and hit return.  When you recall the name of the assigned office, R will output the value assigned to that object.

```{r assignobject, exercise=TRUE}

British_Prime_Ministers <- c("Baldwin", "Chamberlain", "Churchill", "Attlee", "Churchill", "Eden", "MacMillan", "Douglas-Home", "Heath", "Wilson", "Callaghan", "Tatcher", "Major", "Blair", "Brown", "Cameron", "May", "Johnson")

British_Prime_Ministers

``` 

It is helpful to think about the assignment operator  `<-` as the verb "*gets*" or "*is equal to*", reading left to right. The code above can be read "*The object British_Prime_Ministers gets the result of concatenating the following names ("Baldwin", "Chamberlain", "Churchill", etc...)  into a vector using the function `c()`*"


**Shortcuts**: it is possible to call the assignment operator `<-` by using the keyboard shortcut `Option+minus` on MacOS or `Alt+minus` on Windows.


When you create objects assigning things to names with the `<-` operator, they will appear in R’s workspace or environment. Your workspace is specific to your current project. 

![](images/R_Objects_Stored_Environment.png){width=80%}

--- 

### Naming Object

You can give objects names, with a few restrictions:

- no spaces in the name. Instead it is common to use `_` to link different words
- no mathematical operators (-, +, *, /, etc...)
- object names must start with a letter but can include numbers

For instance, can you correct the names below that the code does not return an error when you run it?

```{r CorrectName, exercise = TRUE}

#Store my name in an object called "My Name"
My Name <- "Stefano"

#Print My Name to the console
My Name

```


Names in R are case sensitive. This means that the object my_data is not the same as the object My_Data.
For instance, see what happens when you run the code below:

```{r checkCaseSensitiveName, exercise=TRUE}
# Store your name in variable my_name
my_name <- "Stefano"

# Check if your name is the one assigned
My_Name == "Stefano"

``` 

Running the code will result in the error `Object "My_Name" not found` since we initially stored our name in the object `my_name`

---

## Types of Objects

Objects can be many things:
- a string (character, word, or longer text)
- a number
- a vector (a sequence of strings or numbers)
- a function;
- a matrix (rows and columns of numbers)
- a dataframe (rectangular table consisting of observations and variables)
- a figure or set of figures.
- etc...
We can use the function `class()` to interrogate how a value  has been stored. Knowing an object’s class tells you a lot about what you can and can’t do with it



---

### Numbers

Objects can be numbers.

```{r manipulatenumber, echo=TRUE, exercise=TRUE}
  MyObject <- 2
  
  2 * MyObject
```

When a numerical object is created, this can can be manipulated as other numbers.

```{r GDPperCapita, echo=TRUE, exercise=TRUE}
  # Create object UK_GDP
  UK_GDP <- 2170000000000

  # Create object UK_Population
  UK_Population <- 67886004

  # Calculate gdp per capital
  UK_GDP_Per_Capita <- UK_GDP/UK_population
  UK_GDP_Per_Capita
```



### Characters

Objects can be characters. Any combination of words, numbers, and symbols within quotation marks will be stored as a "character" object 

```{r myname, exercise=TRUE}

  #Store my name in an object called "my_name"
  my_name <- "Stefano"

  #Print the content of the object "my_name" in the console
  my_name
```

 If we store a number within quotation marks, R will treat this as a character and it won't be possible to perform any traditional mathematical operation on it.

```{r myname_class_error, exercise=TRUE}
  UK_GDP <- "2170000000000"

  class(UK_GDP)
```

For instance,  in the code below we would like to calculate the total population of the UK, but running te code will result in an error. Can you fix it?

```{r UKPopulation, exercise=TRUE}
  # Save the Population of UK Nations in separate objects
  Pop_England <- "53107169"
  Pop_Scotland <- "5299900"
  Pop_Wales <- "3063758"
  Pop_NIreland <- "1814318"

  # Calculate Population United Kingdom
  Pop_UK <- Pop_England + Pop_Scotland + Pop_Wales + Pop_NIreland
  
  # Print the results in the console
  Pop_UK
```

```{r UKPopulation-solution}
  # Save the Population of UK Nations in separate objects
  Pop_England <- 53107169
  Pop_Scotland <- 5299900
  Pop_Wales <- 3063758
  Pop_NIreland <- 1814318

  # Calculate Population United Kingdom
  Pop_UK <- Pop_England + Pop_Scotland + Pop_Wales + Pop_NIreland
  
  # Print the results in the console
  Pop_UK
``` 
<div id="UKPopulation-hint">
**Hint:** Wrapping a number around quotation marks will transform this into a "string" object.
</div>

---

### Logical

Objects can also be ***logical (booleans)*** statements that take either a `true` or `false` value.

For instance we can check whether an object has a certain value or wether two objects have the same value by using the equality operator (`==`). The result will be a logical value (true/false) that can also be stored in a object. 

```{r ismynameMark, exercise=TRUE}

  # Store my name into object called "my_name"
  my_name <- "Stefano"

  # check if my_name is equal to "Mark" and store it in an object called "am_I_Mark"
  am_I_Mark <- (my_name == "Mark") 

  # print the results of am_I_Mark
  am_I_Mark

  # check what type of object is "am_I_Mark"
  class(am_I_Mark)
```

 
```{r twoplustwoisfive, echo=TRUE, exercise = TRUE}
  two_plus_two_is_five <- (2 + 2 == 5)
  two_plus_two_is_five
```

---

### Vectors

A vector is a collection of values arranged in some order. Vectors are the building blocks of data sets.

We build vectors in R using the function `c()`, which is short for concatenate. The different elements of the vector are placed within parentheses and separated by a comma.

  
```{r createvector, echo=TRUE, exercise = TRUE}

#Create vector composed of 7 different strings, divided by a comma
Seven_Dwarves <- c("Doc", "Grumpy", "Happy", "Sleepy", "Bashful", "Sneezy", "Dopey")

Seven_Dwarves
```



The function `c()` can also be used to combine different vectors or objects into a single vector:

```{r UKLeaders, echo=TRUE, exercise = TRUE}
Tory_Leader <- "Johnson"

Labour_Leader <- "Starmer"

Libdem_Leader <- "Davey"

SNP_Leader <- "Sturgeon"

UK_Party_Leader <- c(Tory_Leader, Labour_Leader, Libdem_Leader, SNP_Leader)

UK_Party_Leader
 
```

Many R commands can be applied to a vector. For instance, the function `max` returns the highest value in a numerical vector, while the function `min` returns the lowest value in a numerical vector.


```{r MaxUS_Inflation_2020, echo=TRUE, exercise = TRUE}
#Create vector including the monthly inflation rates in the US
US_Inflation_2020 <- c(0.39, 0.27, 0.22, 0.67, 0.002, 0.55, 0.51, 0.32, 0.14, 0.04, 0.06, 0.09 )

#identify the element of the vector with the highest value using 
max(US_Inflation_2020)

min(US_Inflation_2020)

```
 
The function `sum` adds up the different element of a numerical vector

```{r SumVotes, echo=TRUE, exercise = TRUE}
#Create vector including the monthly inflation rates in the US

Votes_Yay <- 120
Votes_Nay <- 84
Votes_Abstain <- 5

#Create vector with all votes
All_Votes <- c(Votes_Yay, Votes_Nay, Votes_Abstain)
 
sum(All_Votes)
``` 



---


## Functions in R


### What are Functions in R

**Functions** are commands called to perform specific actions on your **objects** or any other **input** that you assign. In order to have a function do something for us, we need to call it.

Functions include typical commands that you might execute to import data, analyze data, create maps using geographic data;  scrape text, pictures, links, and other data from webpages; to download documents and examine text for similarity, repetition, sentiment, etc…


### Recognizing functions

Functions are denoted by a name followed by a set of parentheses that contain an input (or object) or series of inputs (separated by commas) on which the function should be executed. 

R has many built-in functions. For example:

- `round()` to round a number up to a certain number of decimals

```{r rounddown, exercise = TRUE}
round(3.4)
``` 

```{r roundup, echo=TRUE, exercise = TRUE}
round(3.6)
```

- `paste()` to combine two or more strings into a single string

```{r pastename, exercise = TRUE}

my_name <- "Stefano"

paste("Hi, my name is" , my_name)
```

- `mean()` to calculate the average value of a vector of numbers

```{r meanexample, exercise = TRUE}

US_Inflation_Jan2020 <- 0.39
US_Inflation_Feb2020 <- 0.27
US_Inflation_Mar2020 <- 0.22
US_Inflation_Apr2020 <- 0.67  
US_Inflation_May2020 <- 0.002
US_Inflation_Jun2020 <- 0.55
US_Inflation_Jul2020 <- 0.51
US_Inflation_Aug2020 <- 0.32
US_Inflation_Sept2020 <- 0.14
US_Inflation_Oct2020 <- 0.04
US_Inflation_Nov2020 <- 0.06
US_Inflation_Dec2020 <- 0.09

Average_US_Inflation <- mean(US_Inflation_Jan2020,
                       US_Inflation_Feb2020,
                       US_Inflation_Mar2020,
                       US_Inflation_Apr2020,
                       US_Inflation_May2020,
                       US_Inflation_Jun2020,
                       US_Inflation_Jul2020,
                       US_Inflation_Aug2020,
                       US_Inflation_Sept2020,
                       US_Inflation_Oct2020,
                       US_Inflation_Nov2020,
                       US_Inflation_Dec2020)

Average_US_Inflation					   
					   
```


### Help with functions
  
If you want to learn more about a function, type ? and then the function name into the console. For example `?round`

  
```{r helpround, echo=TRUE, exercise = TRUE}
  ?round
```

### Activity: What do these functions do?

Run and edit the different code chunks below and find out what each of these functions does. You can find more information by typing `?` followed by the function's name?
What do these functions do?

- `tolower()`

```{r tolower, echo=TRUE, exercise = TRUE}
tolower("STRING")

# You can find more information about this function by typing ?tolower 
```

- `length()`

```{r length, echo=TRUE, exercise = TRUE}
length(c("Doc", "Grumpy", "Happy", "Sleepy", "Bashful", "Sneezy", "Dopey")) 

# You can find more information about this function by typing ?length 
```

- `sqrt()`

```{r sqrt, echo=TRUE, exercise = TRUE}
sqrt(81)

# You can find more information about this function by typing ?sqrt 
```

- `gsub()`

```{r gsub, echo=TRUE, exercise = TRUE}
gsub("Tuesday", "Wednesday", "Today is Tuesday")

# You can find more information about this function by typing ?gsub

```

- `sort()`

```{r sort, echo=TRUE, exercise = TRUE}
sort(c(14, 12, 16, 9))

# You can find more information about this function by typing ?sort
```

- `grepl()`

```{r grepl, echo=TRUE, exercise = TRUE}
grepl("day", "Wednesday")

grepl("day", "March")
# You can find more information about this function by typing ?grepl
```



---

## R Packages

While a number of common function come pre-loaded when you open R, others need to be imported into your working environment by loading ***packages***.

Packages allow you to build upon the work done by others to complete your tasks when analyzing data or creating in R.


### How to install packages

In order to access the commands included in packages, you will need to *install* these packages into R the first time you use them, and *load* them in your workspace every time you use them.

In order to install a package you will call the function `install.packages("NAME OF THE PACKAGE")`. 
You can install packages into R by hand-selecting Install, Packages from the Files/Help/Packages panel, and typing in the "package_name".

![](images/Packages_Panel.png){width=50%}

### Loading packages

In order to use the functions contained in a package, you will need to first load them in your work environment using the `library()` function.

You must load the package into the R "library" in order to use it, after it is installed.

In RStudio Cloud, each time you open a new R session online, you will need to load the packages you wish to use in that session.

To load packages, you can:

- Type `library(package_name)`
- Select the package from the list of packages using the Files/Packages/Help panel.



### Tidyverse

In this module we will do the bulk of the analysis a few important packages:

- `dplyr()` to manipulate the data
- `ggplot2()` to visualize the data
- `tidyr()` 


![](images/Tidyverse_Logo.png){width=50%}

These packages are part of a common group of packages called `tidyverse`. You can install and load all the packages that are part of the tidyverse using

Example, in order to load the "tidyverse" package  

```{r load_tidyverse, echo=TRUE, exercise = TRUE}
install.packages("tidyverse")

library(tidyverse)
```  
 

---

